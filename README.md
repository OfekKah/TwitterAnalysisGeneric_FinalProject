# Social Network Group Analysis Package

This project is a Generic Social Network Group Analysis Package implemented in Python. It allows for the analysis of group interactions on social networks, focusing on:
- Exploratory Data Analysis (EDA)
- Sentiment and Emotion Analysis
- Topic Modeling

The package is designed to process and analyze data efficiently, offering a robust foundation for understanding group behavior, key themes, and sentiment distribution.

---

## Features

1. **EDA**:
   - **Analysis of Social Network Data**:
      - Accepts a database containing `authors` and `posts` tables.
      - Performs population-specific analysis if the `label` column exists in the `authors` table.
   - **Location Analysis**:
      - Extracts country information using the Llama model from the `location` column in the `authors` table.
2. **Sentiment, Emotion, and Hate Speech Analysis:**:
   - Performs analysis using three pre-trained deep learning models for `sentiment`, `emotion`, and `hate speech` detection.
   - Detects sentiment polarity (positive/negative/neutral) and emotion probabilities (e.g., joy, sadness, anger).
   - The output of running the model is saved in a dedicated directory.
   - Inside output directory, three TSV files contain the analysis results for each model: emotion_results.tsv, sentiment_results.tsv, and hate_speech_results.tsv. These files include processed data such as authors, dates, content, and calculated statistics related to each respective analysis type.
   - The output directory contains three subdirectories: emotion_analysis_graphs, sentiment_analysis_graphs, and hate_speech_analysis_graphs, which store visual graphs generated from the analysis results.
3. **Topic Modeling**:
   - Extracts the main themes from social network group posts using techniques like Latent Dirichlet Allocation (LDA) or Non-Negative Matrix Factorization (NMF).
---

## Requirements

To install all required dependencies, use the `requirements.txt` file:

```bash
pip install -r requirements.txt
```

---

## Usage

**Database Requirements**

The database must include the following tables and columns with the exact names:

- **Posts Table**:
  
   Columns:
     - `author`
     - `date`
  
- **Authors Table**:
  
   Columns:
     - `author_screen_name`
     - `friends_count`
     - `followers_count`
     - `statuses_count`
     - `location`
     - `content`
  
   Optional: `label` column for group-based analysis.

---

## Outputs

1. **EDA**:
   The following outputs are generated by the script:
   - **PNG Graphs**:
     
      **When analyzing more than one population, the following graphs are created and saved as PNG files:**
     
      For each population:
      - Population_X_followers_count_range
      - Population_X_friends_count_range
      - Population_X_statuses_count_range
      - Population_X_top_authors
      - Population_X_top_countries
      - Population_X_tweet_distribution
      
      Multi-Population Comparative Graphs:
      - Followers_Count_vs_Posts_Count_for_All_Groups
      - Followers_Count_Range_Merged
      - Friends_Count_Range_Merged
      - Posts_Count_Range_Merged
      - Tweet_Distribution_by_Month_for_All_Groups
    
       **When analyzing one population, the following graphs are created and saved as PNG files:**
     
      - All_Populations_followers_count_range
      - All_Populations_friends_count_range
      - All_Populations_statuses_count_range
      - All_Populations_top_authors
      - All_Populations_top_countries
      - All_Populations_tweet_distribution
      - Tweet_Distribution_by_Month_for_All_Populations
      - Followers_Count_vs_Posts_Count_for_All_Populations
   
   - **Summary Statistics**:
     
     A CSV file named summary_statistics.csv, containing aggregated statistics for the following columns:
      - `friends_count`
      - `followers_count`
      - `statuses_count`
    
     Additionally, the CSV includes a group column to indicate the population to which the statistics belong.
2. **Sentiment and Emotion analysis**


## Output Directory Structure
The code creates a directory named `output_analysis` containing the following files and subdirectories:

```
output_analysis/
├── emotion_results.tsv
├── emotion_checkpoint.pkl
├── sentiment_results.tsv
├── sentiment_checkpoint.pkl
├── hate_speech_results.tsv
├── hate_speech_checkpoint.pkl
├── emotion_analysis_graphs/
│   └── trends_plot.png
├── sentiment_analysis_graphs/
│   └── trends_plot.png
└── hate_speech_analysis_graphs/
    └── trends_plot.png
```

## Data Files

### Task-Specific Results (TSV Files)
Each analysis task generates a tab-separated values (TSV) file:

1. `emotion_results.tsv`:
   - Contains emotion analysis scores for each tweet
   - Columns include: author, new_date, content, and emotion probabilities (joy, sadness, anger, surprise, etc.)

2. `sentiment_results.tsv`:
   - Contains sentiment analysis scores for each tweet
   - Columns include: author, new_date, content, and sentiment probabilities (positive, negative, neutral)

3. `hate_speech_results.tsv`:
   - Contains hate speech detection scores for each tweet
   - Columns include: author, new_date, content, and hate speech probabilities

### Checkpoint Files
Each `.pkl` file stores the processing progress for its respective task:
- `emotion_checkpoint.pkl`
- `sentiment_checkpoint.pkl`
- `hate_speech_checkpoint.pkl`

These files allow the processing to resume from where it left off if interrupted.

## Visualization Outputs

### Trend Plots
Each analysis task generates a set of trend plots saved in their respective directories:

1. `emotion_analysis_graphs/trends_plot.png`:
   - Shows the evolution of different emotions over time
   - Each line represents a different social group (based on author labels)
   - Y-axis: Probability scores (0-1)
   - X-axis: Timeline (Year-Month)

2. `sentiment_analysis_graphs/trends_plot.png`:
   - Displays sentiment trends over time
   - Separate lines for each social group
   - Y-axis: Sentiment probability scores
   - X-axis: Timeline (Year-Month)

3. `hate_speech_analysis_graphs/trends_plot.png`:
   - Shows hate speech detection trends over time
   - Separate lines for different social groups
   - Y-axis: Probability scores
   - X-axis: Timeline (Year-Month)

## Data Processing Details

### Time Aggregation
- Data is aggregated monthly
- Each point in the trend plots represents the mean value for that month
- The means are calculated in two steps:
  1. First calculates means per author per month
  2. Then calculates the mean across all authors in each social group

### Group Analysis
- Results are separated by social groups defined in the authors table
- Each group's trends are plotted with different colors for easy comparison
- Legend identifies which line corresponds to which social group

## Reading the Visualizations

### Interpretation Guidelines
1. Higher values indicate stronger presence of the analyzed attribute
2. Trends can be compared across different social groups
3. Sudden spikes or dips might indicate significant events or temporal patterns
4. The confidence of predictions can be assessed by the probability scores

### Color Coding
- Each social group is assigned a unique color in the plots
- Consistent color scheme maintained across all visualizations for easy comparison

## Note on Data Processing
- The analysis is performed in batches (default: 1000 tweets per batch)
- Processing can be limited by setting max_batches (default: 10 batches)
- Text is cleaned and preprocessed before analysis
- Dates are standardized to ensure consistent temporal analysis

## Requirements for Viewing Outputs
- TSV files can be opened with any spreadsheet software (Excel, Google Sheets, etc.)
- PNG files can be viewed with any image viewer
- Checkpoint files (.pkl) are binary files used by the program and not meant for direct viewing
---

## Authors
- Shay Herling 
- Ofek Kachlon
- Eden Naroditsky
- Shahar Revivo
